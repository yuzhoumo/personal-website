<!DOCTYPE HTML>
<html lang="en">
    <head>
        <!-- Scripts -->
        <script crossorigin="anonymous" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" src="https://code.jquery.com/jquery-3.2.1.slim.min.js">
        </script>
        <script crossorigin="anonymous" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js">
        </script>
        <script crossorigin="anonymous" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js">
        </script>
        <script src="../assets/scripts/include.js">
        </script>
        <!-- Favicon -->
        <link href="../assets/img/icons/favicon.png" rel="shortcut icon" type="image/png"/>
        <!-- Include: blog-head.html -->
        <div include-html="../assets/includes/blog-head.html">
        </div>
        <!-- TAB TITLE -->
        <title>
            Fixing WSL2 DNS Resolution - Joe Mo
        </title>
    </head>
    <body>
        <!-- Check if JavaScript is disabled -->
        <h1 id="enabled-js-message" style="text-align: center">
            Please enable JavaScript to properly view this website.
        </h1>
        <script id="enabled-js-script">
            document.getElementById("enabled-js-message").remove();
        </script>
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <a class="navbar-brand" href="/" style="font-size: 12pt">
                <img src="../assets/img/icons/logo.png" width="32px"/>
            </a>
            <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarSupportedContent" data-toggle="collapse" type="button">
                <span class="navbar-toggler-icon">
                </span>
            </button>
            <!-- Include: nav-links.html -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent" include-html="../assets/includes/nav-links.html">
            </div>
        </nav>
        <!-- Blog Section -->
        <div class="container">
            <div class="jumbotron jumbo-section" id="blog-main-jumbotron">
                <!-- Include: blog-content-head.html -->
                <div id="blog-content-head" include-html="../assets/includes/blog-content-head.html">
                </div>
                <!-- FEATURED IMAGE -->
                <div style="width:100%; text-align: center">
                    <img class="img-fluid" id="featured-image" src=""/>
                </div>
                <!-- BLOG TITLE/SUBTITLE -->
                <h1 id="blog-title">
                    Fixing WSL2 DNS Resolution
                </h1>
                <!-- Include: blog-content-sub.html -->
                <div id="blog-content-sub" include-html="../assets/includes/blog-content-sub.html" style="display: inline-block">
                </div>
                <h5 id="blog-subtitle" style="display: inline-block">
                    Joe Mo | January 4, 2021 | 1 Minute Read |
                </h5>
                <!-- Theme Toggle Switch -->
                <div class="custom-control custom-switch" style="display: inline-block">
                    <input class="custom-control-input" id="dark-toggle" type="checkbox"/>
                    <label class="custom-control-label" for="dark-toggle" id="dark-toggle-label">
                        Light Theme
                    </label>
                    <script src="../assets/scripts/blogThemeToggle.js">
                    </script>
                </div>
                <br/>
                <br/>
                <!-- BLOG CONTENT -->
                <div id="blog-content">
                    <p>
                        Recently, I've switched to using WSL2 on my Windows machine. It works quite well and has a ton of performance
improvements over WSL, but there's a major annoyance with the way DNS is configured through the Hyper-V Virtual
Ethernet adapter. VPN users beware! There are known DNS leak issues with WSL2 (documented
                        <a href="https://mullvad.net/en/blog/2020/9/30/linux-under-wsl2-can-be-leaking/">
                            here
                        </a>
                        ) that could compromise the privacy
of your web traffic.
                    </p>
                    <p>
                        This isn't that big of an issue for me, however, since I don't really use WSL2 for anything I'd consider critical
(mostly just using network connectivity for installing packages, pushing to git repos, etc). The bigger problem is that
my DNS queries will fail to resolve at all while I have active VPN connections. Here's a quick workaround, documented
below for my own future reference and anyone else who might be having this same issue:
                    </p>
                    <ol>
                        <li>
                            Create a file at the following location:
                            <code>
                                /etc/wsl.conf
                            </code>
                        </li>
                        <li>
                            It should have the following contents:
                        </li>
                    </ol>
                    <p>
                        <code>
                            [network]
generateResolvConf = false
                        </code>
                    </p>
                    <ol>
                        <li>
                            Run
                            <code>
                                wsl --shutdown
                            </code>
                            in a
                            <code>
                                cmd
                            </code>
                            window and restart WSL2.
                        </li>
                        <li>
                            Create another file:
                            <code>
                                /etc/resolv.conf
                            </code>
                            , replacing it if it already exists.
                        </li>
                        <li>
                            It should have the following contents:
                        </li>
                    </ol>
                    <p>
                        <code>
                            nameserver YOUR_DNS_SERVER_HERE
                        </code>
                    </p>
                    <ol>
                        <li>
                            Repeat step 3. Now WSL2 should be using the DNS server you've specified!
                        </li>
                    </ol>
                    <ul>
                        <li>
                            Note: For step 5, replace
                            <code>
                                YOUR_DNS_SERVER_HERE
                            </code>
                            with your desired DNS server. I like to use
                            <a href="https://adguard.com/en/adguard-dns/overview.html#instruction">
                                Adguard DNS servers
                            </a>
                            , but some other options are
                            <code>
                                8.8.8.8
                            </code>
                            for Google DNS,
                            <code>
                                1.1.1.1
                            </code>
                            for CloudFlare DNS, and
                            <code>
                                45.90.28.192
                            </code>
                            for NextDNS.
                        </li>
                    </ul>
                    <p>
                        Credit:
                        <a href="https://github.com/microsoft/WSL/issues/4285#issuecomment-522201021">
                            https://github.com/microsoft/WSL/issues/4285#issuecomment-522201021
                        </a>
                    </p>
                </div>
                <!-- Include: blog-pre-footer.html -->
                <div id="blog-pre-footer" include-html="../assets/includes/blog-pre-footer.html">
                </div>
            </div>
        </div>
        <!-- Scroll Back to Top Button -->
        <button class="btn btn-primary btn-circle" href="" id="scroll-to-top" type="button">
            <i class="fa fa-chevron-up" style="font-size: 32px; text-align: center; margin-top: 3px">
            </i>
            <script src="../assets/scripts/scrollToTop.js">
            </script>
        </button>
        <!-- Footer -->
        <footer class="footer-text" id="article-footer">
            <p style="display:inline-block">
                Copyright Â©
                <script>
                    document.write(new Date().getFullYear())
                </script>
            </p>
            <!-- Include footer.html -->
            <p include-html="../assets/includes/footer.html" style="display:inline-block">
            </p>
        </footer>
        <!-- Insert Includes -->
        <script>
            includeHTML();
        </script>
    </body>
</html>